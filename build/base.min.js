/*
 * Base.js by aucguy. Under MIT License.
 * built on  2016-03-21
 */

var base=function(a){function b(a){H=a,A(errorCallbacks,a),console.error(a.stack);var b=document.getElementById("error div"),c=document.getElementById("error text"),d=document.getElementById("display");c&&(c.innerHTML=a.stack),b&&(b.style.display="block"),d&&(d.style.display="none")}function c(a){if(!H)try{a()}catch(c){b(c)}}function d(a){return function(){c(a)}}function e(a,b){return function(){var c=1==arguments.length?[arguments[0]]:Array.apply(null,arguments);c[0]=base.external(c[0]);var d=a.apply(null,c);return b.push(d),d}}function f(a,b){return function(b){a(b),D.splice(D.indexOf(b),1)}}function g(a,b,c,e){var f=d(c);a.addEventListener(b,f,e),E.push({element:a,event:b,ext:f,callback:c,capture:e})}function h(a,b,c){for(var d=0;d<E.length;d++){var e=E[d];if(e.element==a&&e.event==b&&e.callback==c){e.element.removeEventListener(b,e.ext),E.splice(d,1);break}}}function i(){for(var b={},c=a;c;){for(var d=Object.getOwnPropertyNames(c),e=0;e<d.length;e++){var f=d[e],g=a[f];console.log(f),"function"==typeof g?b[f]=g.bind(a):b[f]=g}c=Object.getPrototypeOf(c)}return b.setInterval=I,b.clearInterval=J,b.requestAnimationFrame=M,b.cancelAnimationFrame=N,b.setTimeout=O,b.clearTimeout=P,b}function j(a,b){var c={name:a,scope:null,initFunc:b};Q[a]=c,A(R,c)}function k(a){var b=Q[a];if(!b)throw new Error("module '"+a+"' is not defined");return b.scope||(b.scope=b.initFunc()),b.scope}function l(a){return S[a].data}function m(a,b,c,d,e){return{type:c,id:a,url:b,data:d,xhr:e?e:null}}function n(a,b,c){a in S||(r(),t(u(T,b),function(d){try{S[a]=m(a,b,c,d.responseText,d),s()}catch(e){throw s(),e}},function(b){throw s(),new Error("failed to retrieve asset "+a)}))}function o(a,b,c){if(!(a in S)){r();var d=document.createElement(c);"script"==c?document.head.appendChild(d):(d.onload=function(){S[a]=m(a,b,c,d),s()},d.onerror=function(){throw new Error("failed to load asset"+a+" at "+b)}),d.src=u(T,b)}}function p(a,b,c){"text"==c?n(a,b,c):"script"==c?o(a,b,c):o(a,b,c)}function q(a){for(var b=0;b<a.length;b++)p(a[b][0],a[b][1],a[b][2])}function r(){U=0>U?1:U+1}function s(){U--,V++}function t(a,b,c){"undefined"==typeof c&&(c=function(b){console.warn("asset '"+a+"' failed to load with a status of "+b.status)});var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=d(function(){4==e.readyState&&(200==e.status||0===e.status?b(e):c(e))}),e.open("GET",a,!0),e.send()}function u(){for(var a=[],b=0,c=arguments.length;c>b;b++)a=a.concat(arguments[b].split("/"));var d=[];for(b=0,c=a.length;c>b;b++){var e=a[b];e&&"."!==e&&(".."===e?d.pop():d.push(e))}return(a[0].startsWith("/")||a[0].startsWith("\\"))&&d.unshift(""),d.join("/")||(d.length?"/":".")}function v(){x(),Z=I(w,100),z(X.INDEX_NOT_LOADED)}function w(){y(),x(),0===U&&(z(X.APP_INITING),mainModule=k("main"),mainModule.init(),z(X.APP_RUNNING))}function x(){var a=document.getElementById(Y),b=a.getContext("2d");b.fillStyle="#000000",b.fillRect(0,0,a.width,a.height),b.textBaseline="top",b.font="72px Arial",b.strokeStyle="#FFFFFF";var c,d;if($==X.ASSETS_LOADING){var e=U+V;d="Loading: "+e+"/"+e,c="Loading: "+V+"/"+e}else c=$==X.APP_INITING?"Initializing":"Bad State",d=c;var f=b.measureText(d);b.strokeText(c,a.width/2-f.width/2,a.height/2-36)}function y(){$==X.INDEX_NOT_LOADED&&null!==W&&(W(),z(X.ASSETS_LOADING))}function z(a){a!=$&&($=a,A(stateChangeCallbacks,a))}function A(a,b){for(var c=0;c<a.length;c++)a[c](b)}errorCallbacks=[];for(var B,C,D=[],E=[],F=[],G=[],H=null,I=e(setInterval,D),J=f(clearInterval,D),K=["ms","moz","webkit","o"],L=0;L<K.length&&!B;L++)B=a[K[L]+"RequestAnimationFrame"],C=a[K[L]+"CancelAnimationFrame"];var M=e(B,F),N=f(C,F),O=e(setTimeout,G),P=f(clearTimeout,G);errorCallbacks.push(function(a){var b;for(b=0;b<D.length;b++)J(D[b]);for(b=0;b<E.length;b++){var c=E[b];h(c.element,c.event,c.callback)}for(b=0;b<F.length;b++)N(F[b]);for(b=0;b<G.lenght;b++)clearTimeout(G[b])});var Q={},R=[],S={},T="",U=-1,V=0,W=(a.base?a.base.indexFunc:null)||[];R.push(s);var X={BASE_NOT_LOADED:0,INDEX_NOT_LOADED:1,ASSETS_LOADING:2,APP_INITING:3,APP_RUNNING:4},Y="display",Z=null,$=X.BASE_NOT_RUN;return stateChangeCallbacks=[],stateChangeCallbacks.push(function(a){a==X.APP_INITING&&(J(Z),x())}),stateChangeCallbacks.push(y),g(document,"DOMContentLoaded",v,!1),{onError:b,runSafely:c,external:d,setInterval:I,clearInterval:J,addEventListener:g,removeEventListener:h,requestAnimationFrame:B,cancelAnimationFrame:N,setTimeout:setTimeout,clearTimeout:clearTimeout,customWindow:i,getErrorCallbacks:function(){return errorCallbacks},getRegisterCallbacks:function(){return R},registerModule:j,importModule:k,getBasePath:function(){return T},setBasePath:function(a){T=a},getAsset:l,getAssets:function(){return S},loadText:n,loadTag:o,loadAsset:p,loadAssets:q,decrLoading:s,getStates:function(){return X},getStateChangeCallbacks:function(){return stateChangeCallbacks},getLoadingState:function(){return $},setLoadingState:function(a){z(a)}}}(this);
//# sourceMappingURL=base.min.js.map